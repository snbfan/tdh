function gallery(t,e){this.data=void 0,this.url=t,this.collection=[],this.category=e,this.width=void 0,this.height=void 0,this.minWidth=300,this.minAdWidth=135,this.arrowWidth=64,this.wrapperWidth=void 0,this.adWidth=void 0,this.offset=0,this.picsOnScreen=void 0,this.imageContainer=void 0,this.detectScreenSize()}gallery.prototype.render=function(){this.renderTemplate(),this.renderCollection()},gallery.prototype.parseData=function(){if(this.data)for(var t in this.data)this.data[t].category==this.category&&this.collection.push(this.data[t])},gallery.prototype.detectScreenSize=function(){this.width=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,this.height=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight},gallery.prototype.buttonDisplayStyle=function(){return this.width-20<2*this.arrowWidth+this.minAdWidth*this.collection.length?"block":"none"},gallery.prototype.clickPrevious=function(){return this.offset<=0?!1:void(this.imageContainer.style.margin="0 0 0 -"+this.adWidth*--this.offset+"px")},gallery.prototype.clickNext=function(){return this.offset>=this.collection.length-this.picsOnScreen?!1:void(this.imageContainer.style.margin="0 0 0 -"+this.adWidth*++this.offset+"px")},gallery.prototype.renderTemplate=function(){var t=this.buttonDisplayStyle(),e=document.createElement("div");e.setAttribute("class","liquid"),document.getElementsByTagName("body")[0].appendChild(e),e.style.width=(this.width-20>this.minWidth?this.width-20:this.minWidth)+"px";var i=document.createElement("span");i.setAttribute("class","previous"),i.style.display=t,i.addEventListener("click",this.clickPrevious.bind(this)),e.appendChild(i);var n=document.createElement("div");n.setAttribute("class","wrapper"),this.wrapperWidth=e.clientWidth-2*i.clientWidth,n.style.width=this.wrapperWidth+"px",e.appendChild(n);var s=this.imageContainer=document.createElement("ul");n.appendChild(s);var r=document.createElement("span");r.setAttribute("class","next"),r.style.display=t,r.addEventListener("click",this.clickNext.bind(this)),e.appendChild(r)},gallery.prototype.calcAdWidth=function(){var t=this.wrapperWidth-10;return numOfPics=Math.floor(t/this.minAdWidth),this.picsOnScreen=numOfPics>this.collection.length?this.collection.length:this.width<this.height&&this.width>450?3:Math.floor(t/this.minAdWidth),Math.floor(t/this.picsOnScreen)},gallery.prototype.renderCollection=function(){this.collection.length&&(this.adWidth=this.calcAdWidth(),this.collection.forEach(function(t){var e=document.createElement("li");e.style.width=this.adWidth+"px",this.imageContainer.appendChild(e);var i=document.createElement("span");i.setAttribute("class","price"),e.appendChild(i),i.innerHTML=t.price;var n=document.createElement("img");n.setAttribute("width","130px"),n.setAttribute("border","0"),n.src=t.img,e.appendChild(n);var s=document.createElement("span");s.setAttribute("class","title"),e.appendChild(s),s.innerHTML=this.beautifyTitle(t.title)}.bind(this)))},gallery.prototype.beautifyTitle=function(t){return t.trim().substring(0,20).split(" ").slice(0,-1).join(" ")+"..."},gallery.prototype.ajax=function(t,e){return e=new XMLHttpRequest,e.open("GET",t),t=[],e.onreadystatechange=e.then=function(i,n,s){if(i&&i.call&&(t=[,i,n]),4==e.readyState&&(s=t[0|e.status/200]))try{s(JSON.parse(e.responseText),e)}catch(r){s(null,e)}},e.send(),e},gallery.prototype.fetchData=function(){return this.ajax(this.url)},gallery.prototype.process=function(){this.fetchData().then(this.processSuccess.bind(this),this.processError.bind(this))},gallery.prototype.processError=function(t,e){console.error(t,e.status)},gallery.prototype.processSuccess=function(t){this.data=t,this.parseData(),this.render()};
